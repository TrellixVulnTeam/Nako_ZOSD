{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Desktop/Nako/nako/src/desktop/game/game.tsx\";\nimport React from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\nimport Monster from \"../../assets/monsters/monster\";\nimport { animate, delay } from \"../../utils/utils\";\nimport AnsweringModule from \"../AnsweringMC/answeringModule\";\nimport styles from \"./game.module.scss\";\nimport WinSound from \"./Nako Win.wav\";\nimport FailSound from \"./Nako Wrong.wav\";\nimport Result from \"./result\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar GamePhase;\n\n(function (GamePhase) {\n  GamePhase[GamePhase[\"Transition\"] = 0] = \"Transition\";\n  GamePhase[GamePhase[\"Active\"] = 1] = \"Active\";\n  GamePhase[GamePhase[\"Ended\"] = 2] = \"Ended\";\n})(GamePhase || (GamePhase = {}));\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.play = music => {\n      let audio = new Audio(music);\n      audio.play();\n    };\n\n    this.studentFlow = () => {\n      console.log(\"subbing\");\n      this.props.connection.subscribe(\"req\", \"game_update\").then(async msg => {\n        this.setState({\n          currentPhase: GamePhase.Transition\n        });\n        await new Promise(res => this.setState({\n          onSlideAnimComplete: res\n        }, () => console.log(\"Waiting for slide-in animation to complete\")));\n        this.setState({\n          questionCount: this.state.questionCount + 1,\n          currentQuestion: msg.currentQuestion\n        });\n\n        if (this.state.questionNumberElement.current) {\n          await animate(\"bounce\", this.state.questionNumberElement.current, 500);\n        } else {\n          console.warn(\"questionNumberElement was not found in DOM\");\n        }\n\n        this.props.connection.send({\n          method: \"res\",\n          type: \"game_update\",\n          payload: null\n        });\n        this.props.connection.subscribe(\"req\", \"question_start\").then(() => {\n          this.props.connection.send({\n            method: \"res\",\n            type: \"question_start\",\n            payload: null\n          });\n          console.log(\"Question started\");\n          this.setState({\n            currentPhase: GamePhase.Active,\n            correctAnswer: undefined\n          });\n          this.props.connection.subscribe(\"req\", \"question_end\").then(msg => {\n            this.props.connection.send({\n              method: \"res\",\n              type: \"question_end\",\n              payload: null\n            });\n            console.log(\"Question ended\");\n            this.setState({\n              correctAnswer: msg\n            });\n\n            if (this.state.currentPhase !== GamePhase.Ended) {\n              this.studentFlow();\n            }\n          });\n        });\n      });\n    };\n\n    this.teacherFlow = () => {\n      this.props.connection.subscribe(\"req\", \"game_update\", payload => {\n        this.setState({\n          currentQuestion: payload.currentQuestion\n        });\n        this.props.connection.send({\n          method: \"res\",\n          type: \"game_update\",\n          payload: null\n        });\n      });\n      this.props.connection.subscribe(\"req\", \"question_end\", payload => {\n        var _this$state$monsterRe;\n\n        (_this$state$monsterRe = this.state.monsterRef.current) === null || _this$state$monsterRe === void 0 ? void 0 : _this$state$monsterRe.changeHealth(-payload.stats.correct / this.props.gameInfo.questions.length);\n        this.props.connection.send({\n          method: \"res\",\n          type: \"question_end\",\n          payload: null\n        });\n      });\n    };\n\n    this.state = {\n      questionCount: 0,\n      currentQuestion: -1,\n      currentPhase: this.props.accountInfo.role === \"student\" ? GamePhase.Transition : GamePhase.Active,\n      questionNumberElement: /*#__PURE__*/React.createRef(),\n      //resultScrollDiv: React.createRef<HTMLDivElement>(),\n      //sequentialDisplayCounter: 0,\n      monsterRef: /*#__PURE__*/React.createRef(),\n      showResult: false,\n      result: [{\n        name: \"Test1\",\n        score: 0\n      }, {\n        name: \"Test2\",\n        score: 1\n      }, {\n        name: \"Test3\",\n        score: 2\n      }, {\n        name: \"Test4\",\n        score: 3\n      }, {\n        name: \"Test5\",\n        score: 4\n      }]\n    };\n    this.props.connection.subscribe(\"req\", \"game_end\").then(msg => {\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_end\",\n        payload: null\n      });\n      console.log(\"Game ended\");\n      console.log(msg);\n      this.setState({\n        currentPhase: GamePhase.Ended,\n        result: [...msg].sort((a, b) => b.score - a.score),\n        showResult: true\n      }, () => {\n        if (this.state.result.indexOf(this.state.result.filter(i => i.name === this.props.accountInfo.name)[0]) <= 2) {\n          // Play win Audio \n          this.play(WinSound);\n        } else {\n          // Play loss audio\n          this.play(FailSound);\n        }\n      });\n    });\n    this.props.accountInfo.role === \"student\" ? this.studentFlow() : this.teacherFlow();\n\n    window.toggleSequentialDisplay = () => this.setState({\n      showResult: !this.state.showResult\n    });\n  }\n\n  render() {\n    const {\n      connection,\n      accountInfo,\n      gameInfo,\n      ...rest\n    } = this.props;\n    let renderTarget;\n\n    switch (this.state.currentPhase) {\n      case GamePhase.Transition:\n        renderTarget = /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fill-parent\",\n          id: styles.transition,\n          children: /*#__PURE__*/_jsxDEV(CSSTransition, {\n            in: true,\n            appear: true,\n            exit: false,\n            timeout: 1500,\n            classNames: {\n              appear: styles[\"slide-t2b-appear\"],\n              appearActive: styles[\"slide-t2b-appear-active\"],\n              appearDone: styles[\"slide-t2b-appear-done\"]\n            },\n            onEntered: async () => {\n              console.log(\"Animation completed\");\n              let loggedWarning = false;\n\n              while (!this.state.onSlideAnimComplete) {\n                if (!loggedWarning) {\n                  console.log(\"There was no promise to resolve, forcing delay for one...\");\n                  loggedWarning = true;\n                }\n\n                await delay(200);\n              }\n\n              this.state.onSlideAnimComplete();\n            },\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \"Question \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n                ref: this.state.questionNumberElement,\n                children: this.state.questionCount.toString()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case GamePhase.Active:\n        renderTarget = this.props.accountInfo.role === \"student\" ?\n        /*#__PURE__*/\n        // TODO: Make Answering page generic\n        _jsxDEV(AnsweringModule, {\n          connection: this.props.connection,\n          questionInfo: this.props.gameInfo.questions[this.state.currentQuestion],\n          correctAnswer: this.state.correctAnswer,\n          currentQuestionProps: this.state.currentQuestion\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          id: styles[\"monster-container\"],\n          className: \"fill-parent\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"arrow-left\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Back\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 55\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"Question: \", this.state.currentQuestion + 1]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Monster, {\n              ref: this.state.monsterRef,\n              id: styles.monster\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: this.state.currentQuestion !== -1 ? this.props.gameInfo.questions[this.state.currentQuestion].question : \"Waiting for question...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 11\n        }, this);\n        break;\n\n      default:\n        renderTarget = /*#__PURE__*/_jsxDEV(Result, {\n          in: this.state.showResult,\n          data: this.state.result\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 24\n        }, this);\n        break;\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", { ...rest,\n      children: renderTarget\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 12\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/mac/Desktop/Nako/nako/src/desktop/game/game.tsx"],"names":["React","CSSTransition","Monster","animate","delay","AnsweringModule","styles","WinSound","FailSound","Result","GamePhase","Game","Component","constructor","props","play","music","audio","Audio","studentFlow","console","log","connection","subscribe","then","msg","setState","currentPhase","Transition","Promise","res","onSlideAnimComplete","questionCount","state","currentQuestion","questionNumberElement","current","warn","send","method","type","payload","Active","correctAnswer","undefined","Ended","teacherFlow","monsterRef","changeHealth","stats","correct","gameInfo","questions","length","accountInfo","role","createRef","showResult","result","name","score","sort","a","b","indexOf","filter","i","window","toggleSequentialDisplay","render","rest","renderTarget","transition","appear","appearActive","appearDone","loggedWarning","toString","monster","question"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\nimport Monster from \"../../assets/monsters/monster\";\nimport { AccountInfo } from \"../../modules/account-info\";\nimport NakoAPI, {\n  AccountRole,\n  GameEndRequest,\n  GameInfo,\n  QuestionEndRequest,\n} from \"../../modules/websocket-messages\";\nimport { animate, delay } from \"../../utils/utils\";\nimport AnsweringModule from \"../AnsweringMC/answeringModule\";\nimport styles from \"./game.module.scss\";\nimport WinSound from \"./Nako Win.wav\";\nimport FailSound from \"./Nako Wrong.wav\";\nimport Result from \"./result\";\n\n\ninterface GameProps extends React.HTMLAttributes<HTMLDivElement> {\n  connection: NakoAPI;\n  accountInfo: AccountInfo;\n  gameInfo: GameInfo<AccountRole>;\n}\n\ninterface GameState {\n  questionCount: number;\n  currentQuestion: number;\n  currentPhase: GamePhase;\n  questionNumberElement: React.RefObject<HTMLHeadingElement>;\n  //resultScrollDiv: React.RefObject<HTMLDivElement>;\n  //sequentialDisplayCounter: number;\n  monsterRef: React.RefObject<Monster>;\n  showResult: boolean;\n  onSlideAnimComplete?: (value: void | PromiseLike<void>) => void;\n  correctAnswer?: QuestionEndRequest;\n  result?: GameEndRequest;\n}\n\nenum GamePhase {\n  Transition,\n  Active,\n  Ended,\n}\n\nexport default class Game extends React.Component<GameProps, GameState> {\n  constructor(props: GameProps) {\n    super(props);\n\n    this.state = {\n      questionCount: 0,\n      currentQuestion: -1,\n      currentPhase: this.props.accountInfo.role === \"student\" ? GamePhase.Transition : GamePhase.Active,\n      questionNumberElement: React.createRef<HTMLHeadingElement>(),\n      //resultScrollDiv: React.createRef<HTMLDivElement>(),\n      //sequentialDisplayCounter: 0,\n      monsterRef: React.createRef<Monster>(),\n      showResult: false,\n      result: [{\n        name: \"Test1\",\n        score: 0\n      }, {\n        name: \"Test2\",\n        score: 1\n      }, {\n        name: \"Test3\",\n        score: 2\n      }, {\n        name: \"Test4\",\n        score: 3\n      }, {\n        name: \"Test5\",\n        score: 4\n      }]\n    };\n\n    this.props.connection.subscribe(\"req\", \"game_end\").then((msg) => {\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_end\",\n        payload: null,\n      });\n  \n      console.log(\"Game ended\");\n      console.log(msg);\n  \n      this.setState(\n        { currentPhase: GamePhase.Ended, result: [...msg].sort((a, b) => b.score - a.score), showResult: true },\n        () => {\n          if (this.state.result!.indexOf(this.state.result!.filter(i => i.name === this.props.accountInfo.name)[0]) <= 2) {\n            // Play win Audio \n            this.play(WinSound);\n          } else {\n            // Play loss audio\n            this.play(FailSound);\n          }\n        }\n      );\n    });\n\n    this.props.accountInfo.role === \"student\" ? this.studentFlow() : this.teacherFlow();\n\n    (window as any).toggleSequentialDisplay = () => this.setState({ showResult: !this.state.showResult });\n  }\n\n  play = (music: string) => {\n    let audio = new Audio(music);\n    audio.play();\n  };\n\n  studentFlow = () => {\n    console.log(\"subbing\");\n    this.props.connection.subscribe(\"req\", \"game_update\").then(async (msg) => {\n    this.setState({ currentPhase: GamePhase.Transition });\n    await new Promise<void>(\n      res => this.setState({ onSlideAnimComplete: res }, \n      () => console.log(\"Waiting for slide-in animation to complete\"))\n    );\n\n    this.setState({\n      questionCount: this.state.questionCount + 1,\n      currentQuestion: msg.currentQuestion,\n    });\n\n    if (this.state.questionNumberElement.current) {\n      await animate(\"bounce\", this.state.questionNumberElement.current, 500);\n    } else {\n      console.warn(\"questionNumberElement was not found in DOM\");\n    }\n\n    this.props.connection.send({\n      method: \"res\",\n      type: \"game_update\",\n      payload: null,\n    });\n\n    this.props.connection.subscribe(\"req\", \"question_start\").then(() => {\n      this.props.connection.send({\n        method: \"res\",\n        type: \"question_start\",\n        payload: null,\n      });\n\n      console.log(\"Question started\");\n      this.setState({ currentPhase: GamePhase.Active, correctAnswer: undefined });\n\n      this.props.connection.subscribe(\"req\", \"question_end\").then((msg) => {\n        this.props.connection.send({\n          method: \"res\",\n          type: \"question_end\",\n          payload: null,\n        });\n\n        console.log(\"Question ended\");\n        this.setState({ correctAnswer: msg });\n\n        if (this.state.currentPhase !== GamePhase.Ended) {\n          this.studentFlow();\n        }\n      });\n    });\n  });\n}\n  teacherFlow = () => {\n    this.props.connection.subscribe(\"req\", \"game_update\", payload => {\n      this.setState({ currentQuestion: payload.currentQuestion });\n\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_update\",\n        payload: null\n      });\n    });\n\n    this.props.connection.subscribe(\"req\", \"question_end\", payload => {\n      this.state.monsterRef.current?.changeHealth(-payload.stats.correct / this.props.gameInfo.questions.length);\n\n      this.props.connection.send({\n        method: \"res\",\n        type: \"question_end\",\n        payload: null\n      });\n    });\n  }\n\n  render() {\n    const { connection, accountInfo, gameInfo, ...rest } = this.props;\n    let renderTarget: JSX.Element;\n\n    switch (this.state.currentPhase) {\n      case GamePhase.Transition:\n        renderTarget = (\n          <div className=\"fill-parent\" id={styles.transition}>\n            <CSSTransition\n              in={true}\n              appear={true}\n              exit={false}\n              timeout={1500}\n              classNames={{\n                appear: styles[\"slide-t2b-appear\"],\n                appearActive: styles[\"slide-t2b-appear-active\"],\n                appearDone: styles[\"slide-t2b-appear-done\"]\n              }}\n              onEntered={async () => {\n                console.log(\"Animation completed\");\n\n                let loggedWarning = false;\n\n                while (!this.state.onSlideAnimComplete) {\n                  if (!loggedWarning) {\n                    console.log(\"There was no promise to resolve, forcing delay for one...\");\n                    loggedWarning = true;\n                  }\n\n                  await delay(200);\n                }\n\n                this.state.onSlideAnimComplete();\n              }}\n            >\n              <span>\n                <h1>Question </h1>\n                <h1 ref={this.state.questionNumberElement}>\n                  {this.state.questionCount.toString()}\n                </h1>\n              </span>\n            </CSSTransition>\n          </div>\n        );\n        break;\n\n      case GamePhase.Active:\n        renderTarget = this.props.accountInfo.role === \"student\" ?\n          // TODO: Make Answering page generic\n          <AnsweringModule\n            connection={this.props.connection}\n            questionInfo={\n              this.props.gameInfo.questions[this.state.currentQuestion]\n            }\n            correctAnswer={this.state.correctAnswer}\n            currentQuestionProps={this.state.currentQuestion}\n          /> :\n          <div id={styles[\"monster-container\"]} className=\"fill-parent\">\n            <div>\n              <div>\n                <button><span className=\"arrow-left\"/><span>Back</span></button>\n                <span>Question: {this.state.currentQuestion + 1}</span>\n              </div>\n              <Monster ref={this.state.monsterRef} id={styles.monster}/>\n            </div>\n            <div>\n              <span>{this.state.currentQuestion !== -1 ? this.props.gameInfo.questions[this.state.currentQuestion].question : \"Waiting for question...\"}</span>\n            </div>\n          </div>;\n        break;\n\n      default:\n        renderTarget = <Result in={this.state.showResult} data={this.state.result}/>;\n        break;\n    }\n\n    return <div {...rest}>{renderTarget}</div>;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}