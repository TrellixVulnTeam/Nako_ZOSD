{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Desktop/Nako/nako/src/desktop/game/game.tsx\";\nimport React from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { animate } from \"../../utils\";\nimport AnsweringMC from \"../AnsweringMC/answering_MultipleChoice\";\nimport styles from \"./game.module.scss\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar GamePhase;\n\n(function (GamePhase) {\n  GamePhase[GamePhase[\"Transition\"] = 0] = \"Transition\";\n  GamePhase[GamePhase[\"Active\"] = 1] = \"Active\";\n  GamePhase[GamePhase[\"Ended\"] = 2] = \"Ended\";\n})(GamePhase || (GamePhase = {}));\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      questionCount: 0,\n      currentQuestion: 0,\n      currentPhase: GamePhase.Transition,\n      questionNumberElement: /*#__PURE__*/React.createRef()\n    }; // Gameplay loop\n\n    const loop = () => this.props.connection.subscribe(\"req\", \"game_update\").then(async msg => {\n      if (this.state.questionNumberElement.current) {\n        await new Promise(res => this.setState({\n          onSlideAnimComplete: res\n        }, () => console.log(\"Waiting for animation to complete\")));\n      }\n\n      this.setState({\n        currentPhase: GamePhase.Transition\n      });\n      this.setState({\n        questionCount: this.state.questionCount + 1,\n        currentQuestion: msg.currentQuestion\n      });\n\n      if (this.state.questionNumberElement.current) {\n        await animate(\"bounce\", this.state.questionNumberElement.current, 500);\n      }\n\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_update\",\n        payload: null\n      });\n      this.props.connection.subscribe(\"req\", \"question_start\").then(() => {\n        this.props.connection.send({\n          method: \"res\",\n          type: \"question_start\",\n          payload: null\n        });\n        console.log(\"Question started\");\n        this.setState({\n          currentPhase: GamePhase.Active\n        });\n        this.props.connection.subscribe(\"req\", \"question_end\").then(msg => {\n          this.props.connection.send({\n            method: \"res\",\n            type: \"question_end\",\n            payload: null\n          });\n          console.log(\"Question ended\");\n          this.setState({\n            correctAnswer: msg\n          });\n\n          if (this.state.currentPhase !== GamePhase.Ended) {\n            loop();\n          }\n        });\n      });\n    });\n\n    this.props.connection.subscribe(\"req\", \"game_end\").then(msg => {\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_end\",\n        payload: null\n      });\n      console.log(\"Game ended\");\n      console.log(msg);\n      this.setState({\n        currentPhase: GamePhase.Ended\n      });\n    });\n    loop();\n  }\n\n  render() {\n    const {\n      connection,\n      gameInfo,\n      ...rest\n    } = this.props;\n    let renderTarget;\n\n    switch (this.state.currentPhase) {\n      case GamePhase.Transition:\n        renderTarget = /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fill-parent\",\n          id: styles.transition,\n          children: /*#__PURE__*/_jsxDEV(CSSTransition, {\n            in: true,\n            appear: true,\n            exit: false,\n            timeout: 1500,\n            classNames: {\n              appear: styles[\"slide-in-appear\"],\n              appearActive: styles[\"slide-in-appear-active\"],\n              appearDone: styles[\"slide-in-appear-done\"]\n            },\n            onEntered: () => {\n              console.log(\"Animation completed\");\n\n              if (this.state.onSlideAnimComplete) {\n                this.state.onSlideAnimComplete();\n              } else {\n                console.warn(\"There was no promise to resolve.\");\n              }\n            },\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \"Question \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n                ref: this.state.questionNumberElement,\n                children: this.state.questionCount.toString()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case GamePhase.Active:\n        renderTarget = /*#__PURE__*/_jsxDEV(AnsweringMC, {\n          connection: this.props.connection,\n          questionInfo: this.props.gameInfo.questions[this.state.currentQuestion],\n          correctAnswer: this.state.correctAnswer,\n          currentQuestionProps: this.state.currentQuestion\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this);\n        break;\n\n      default:\n        renderTarget = /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fill-parent\",\n          children: \"TODO: Result UI\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 24\n        }, this);\n        break;\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", { ...rest,\n      children: renderTarget\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 12\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/mac/Desktop/Nako/nako/src/desktop/game/game.tsx"],"names":["React","CSSTransition","animate","AnsweringMC","styles","GamePhase","Game","Component","constructor","props","state","questionCount","currentQuestion","currentPhase","Transition","questionNumberElement","createRef","loop","connection","subscribe","then","msg","current","Promise","res","setState","onSlideAnimComplete","console","log","send","method","type","payload","Active","correctAnswer","Ended","render","gameInfo","rest","renderTarget","transition","appear","appearActive","appearDone","warn","toString","questions"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\nimport NakoAPI, {\n  GameInfo,\n  QuestionEndRequest,\n} from \"../../modules/websocket-messages\";\nimport { animate } from \"../../utils\";\nimport AnsweringMC from \"../AnsweringMC/answering_MultipleChoice\";\nimport styles from \"./game.module.scss\";\n\ninterface GameProps extends React.HTMLAttributes<HTMLDivElement> {\n  connection: NakoAPI;\n  gameInfo: GameInfo;\n}\n\ninterface GameState {\n  questionCount: number;\n  currentQuestion: number;\n  currentPhase: GamePhase;\n  questionNumberElement: React.RefObject<HTMLHeadingElement>;\n  onSlideAnimComplete?: (value: void | PromiseLike<void>) => void;\n  correctAnswer?: QuestionEndRequest;\n}\n\nenum GamePhase {\n  Transition,\n  Active,\n  Ended,\n}\n\nexport default class Game extends React.Component<GameProps, GameState> {\n  constructor(props: GameProps) {\n    super(props);\n\n    this.state = {\n      questionCount: 0,\n      currentQuestion: 0,\n      currentPhase: GamePhase.Transition,\n      questionNumberElement: React.createRef<HTMLHeadingElement>(),\n    };\n\n    // Gameplay loop\n    const loop = () => this.props.connection.subscribe(\"req\", \"game_update\").then(async (msg) => {\n      if (this.state.questionNumberElement.current) {\n        await new Promise<void>(res => this.setState({ onSlideAnimComplete: res }, () => console.log(\"Waiting for animation to complete\")));\n      }\n\n      this.setState({ currentPhase: GamePhase.Transition });\n\n      this.setState({\n        questionCount: this.state.questionCount + 1,\n        currentQuestion: msg.currentQuestion,\n      });\n\n      if (this.state.questionNumberElement.current) {\n        await animate(\"bounce\", this.state.questionNumberElement.current, 500);\n      }\n\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_update\",\n        payload: null,\n      });\n\n      this.props.connection.subscribe(\"req\", \"question_start\").then(() => {\n        this.props.connection.send({\n          method: \"res\",\n          type: \"question_start\",\n          payload: null,\n        });\n\n        console.log(\"Question started\");\n        this.setState({ currentPhase: GamePhase.Active });\n\n        this.props.connection.subscribe(\"req\", \"question_end\").then((msg) => {\n          this.props.connection.send({\n            method: \"res\",\n            type: \"question_end\",\n            payload: null,\n          });\n\n          console.log(\"Question ended\");\n          this.setState({ correctAnswer: msg });\n\n          if (this.state.currentPhase !== GamePhase.Ended) {\n            loop();\n          }\n        });\n      });\n    });\n\n    this.props.connection.subscribe(\"req\", \"game_end\").then((msg) => {\n      this.props.connection.send({\n        method: \"res\",\n        type: \"game_end\",\n        payload: null,\n      });\n\n      console.log(\"Game ended\");\n      console.log(msg);\n      this.setState({ currentPhase: GamePhase.Ended });\n    });\n\n    loop();\n  }\n\n  render() {\n    const { connection, gameInfo, ...rest } = this.props;\n    let renderTarget: JSX.Element;\n\n    switch (this.state.currentPhase) {\n      case GamePhase.Transition:\n        renderTarget = (\n          <div className=\"fill-parent\" id={styles.transition}>\n            <CSSTransition\n              in={true}\n              appear={true}\n              exit={false}\n              timeout={1500}\n              classNames={{\n                appear: styles[\"slide-in-appear\"],\n                appearActive: styles[\"slide-in-appear-active\"],\n                appearDone: styles[\"slide-in-appear-done\"],\n              }}\n              onEntered={() => {\n                console.log(\"Animation completed\");\n\n                if (this.state.onSlideAnimComplete) {\n                  this.state.onSlideAnimComplete();\n                } else {\n                  console.warn(\"There was no promise to resolve.\");\n                }\n              }}\n            >\n              <span>\n                <h1>Question </h1>\n                <h1 ref={this.state.questionNumberElement}>\n                  {this.state.questionCount.toString()}\n                </h1>\n              </span>\n            </CSSTransition>\n          </div>\n        );\n        break;\n\n      case GamePhase.Active:\n        renderTarget = (\n          <AnsweringMC\n            connection={this.props.connection}\n            questionInfo={\n              this.props.gameInfo.questions[this.state.currentQuestion]\n            }\n            correctAnswer={this.state.correctAnswer}\n            currentQuestionProps={this.state.currentQuestion}\n          />\n        );\n        break;\n\n      default:\n        renderTarget = <div className=\"fill-parent\">TODO: Result UI</div>;\n        break;\n    }\n\n    return <div {...rest}>{renderTarget}</div>;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}