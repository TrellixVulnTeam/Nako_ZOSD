{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Desktop/Nako/nako/src/mobile/login/login.tsx\";\n///<reference path=\"../../types/web-nfc.d.ts\">\nimport React from \"react\";\nimport Axios from \"axios\";\nimport { isAccountInfo } from \"../../modules/account-info\";\nimport styles from \"./login.module.scss\";\nimport QRScanner from \"../../modules/qr-scanner/qr-scanner\";\nimport Logo from \"../../modules/logo/logo\";\nimport { delay } from \"../../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar LoginPhase;\n\n(function (LoginPhase) {\n  LoginPhase[LoginPhase[\"menu\"] = 0] = \"menu\";\n  LoginPhase[LoginPhase[\"NFC\"] = 1] = \"NFC\";\n  LoginPhase[LoginPhase[\"QR\"] = 2] = \"QR\";\n})(LoginPhase || (LoginPhase = {}));\n\nexport class Login extends React.Component {\n  constructor(props) {\n    super(props);\n    this.NDEF = new NDEFReader();\n    this.UTF8Decoder = new TextDecoder();\n    this.state = {\n      nfcCapable: true,\n      loginPhase: LoginPhase.menu,\n      controller: new AbortController()\n    };\n\n    this.NDEF.onreading = async e => {\n      var _e$message$records$0$;\n\n      // console.log(e.serialNumber);\n      // console.log(e.message.records);\n      const info = JSON.parse(this.UTF8Decoder.decode((_e$message$records$0$ = e.message.records[0].data) === null || _e$message$records$0$ === void 0 ? void 0 : _e$message$records$0$.buffer));\n      console.log(info);\n\n      if (isAccountInfo(info)) {\n        this.setState({\n          loginInfo: info,\n          loginPhase: LoginPhase.menu\n        });\n        await delay(1000);\n        this.endNFCScan();\n      }\n    };\n  }\n\n  componentWillUnmount() {\n    this.state.controller.abort();\n  } //#region NFC\n\n\n  startNFCScan() {\n    this.NDEF.scan(this.state.controller).then(() => this.setState({\n      loginPhase: LoginPhase.NFC\n    })).catch(error => {\n      console.log(error);\n      this.endNFCScan();\n      this.setState({\n        loginPhase: LoginPhase.menu,\n        nfcCapable: false\n      });\n    });\n  }\n\n  endNFCScan() {\n    this.state.controller.abort();\n    this.setState({\n      controller: new AbortController()\n    });\n  }\n\n  initNFC() {\n    this.NDEF.write(JSON.stringify({\n      name: \"Nako\"\n    })).then(() => console.log(\"Message written\")).catch(error => console.log(error));\n  } //#endregion\n  //#region QR\n\n\n  handleQRData(data) {\n    console.log(`${data}/${JSON.stringify(this.state.loginInfo)}`);\n    Axios.get(`${data}/${JSON.stringify(this.state.loginInfo)}`).catch(error => console.log(error));\n  } //#endregion\n\n\n  render() {\n    const {\n      serverURL,\n      ...rest\n    } = this.props;\n    return /*#__PURE__*/_jsxDEV(\"div\", { ...rest,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `${styles[\"m-login-container\"]} fill-parent`,\n        children: this.state.loginInfo ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: [\"Welcome back, \", this.state.loginInfo.name, \"!\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => this.setState({\n              loginPhase: LoginPhase.QR\n            }),\n            children: \"Desktop login with QR code\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 13\n          }, this), this.state.loginPhase === LoginPhase.QR ? /*#__PURE__*/_jsxDEV(\"div\", {\n            id: styles.qr,\n            className: `${styles.overlay} fill-parent`,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"close\",\n              onClick: () => this.setState({\n                loginPhase: LoginPhase.menu\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Scan the QR code shown on the webpage.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(QRScanner, {\n                className: styles[\"qr-component\"],\n                onScannedData: data => this.handleQRData(data)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 112,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 110,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 13\n          }, this) : null]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Logo, {\n            id: styles.logo,\n            role: \"student\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => this.startNFCScan(),\n            children: \"Login using NFC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 13\n          }, this), this.state.loginPhase === LoginPhase.NFC ? /*#__PURE__*/_jsxDEV(\"div\", {\n            id: styles.nfc,\n            className: `${styles.overlay} fill-parent`,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"close\",\n              onClick: () => {\n                this.endNFCScan();\n                this.setState({\n                  loginPhase: LoginPhase.menu\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Place your Nako card on the back of your device.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 128,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 13\n          }, this) : null]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nLogin.defaultProps = {\n  serverURL: \"http://localhost:5000\"\n};\nexport default Login;","map":{"version":3,"sources":["/Users/mac/Desktop/Nako/nako/src/mobile/login/login.tsx"],"names":["React","Axios","isAccountInfo","styles","QRScanner","Logo","delay","LoginPhase","Login","Component","constructor","props","NDEF","NDEFReader","UTF8Decoder","TextDecoder","state","nfcCapable","loginPhase","menu","controller","AbortController","onreading","e","info","JSON","parse","decode","message","records","data","buffer","console","log","setState","loginInfo","endNFCScan","componentWillUnmount","abort","startNFCScan","scan","then","NFC","catch","error","initNFC","write","stringify","name","handleQRData","get","render","serverURL","rest","QR","qr","overlay","logo","nfc","defaultProps"],"mappings":"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","sourcesContent":["///<reference path=\"../../types/web-nfc.d.ts\">\n\nimport React from \"react\";\nimport Axios from \"axios\";\nimport { isAccountInfo, AccountInfo } from \"../../modules/account-info\";\nimport styles from \"./login.module.scss\";\nimport QRScanner from \"../../modules/qr-scanner/qr-scanner\";\nimport Logo from \"../../modules/logo/logo\";\nimport { delay } from \"../../utils\";\n\nenum LoginPhase {\n  menu,\n  NFC,\n  QR\n}\n\ninterface LoginProps {\n  serverURL: string;\n}\n\ninterface LoginState {\n  nfcCapable: boolean;\n  loginPhase: LoginPhase;\n  controller: AbortController;\n  loginInfo?: AccountInfo;\n}\n\nexport class Login extends React.Component<LoginProps & React.HTMLAttributes<HTMLDivElement>, LoginState> {\n  static defaultProps = {\n    serverURL: \"http://localhost:5000\"\n  }\n\n  private NDEF = new NDEFReader();\n  private UTF8Decoder = new TextDecoder();\n\n  constructor(props: LoginProps & React.HTMLAttributes<HTMLDivElement>) {\n    super(props);\n\n    this.state = {\n      nfcCapable: true,\n      loginPhase: LoginPhase.menu,\n      controller: new AbortController(),\n    };\n\n    this.NDEF.onreading = async e => {\n      // console.log(e.serialNumber);\n      // console.log(e.message.records);\n      const info = JSON.parse(this.UTF8Decoder.decode(e.message.records[0].data?.buffer));\n      console.log(info);\n\n      if (isAccountInfo(info)) {\n        this.setState({ loginInfo: info, loginPhase: LoginPhase.menu });\n        await delay(1000);\n        this.endNFCScan();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.state.controller.abort();\n  }\n\n//#region NFC\n  startNFCScan() {\n    this.NDEF.scan(this.state.controller).then(() => \n      this.setState({ loginPhase: LoginPhase.NFC })\n    ).catch(error => {\n      console.log(error);\n      this.endNFCScan();\n      this.setState({ loginPhase: LoginPhase.menu, nfcCapable: false });\n    });\n  }\n\n  endNFCScan() {\n    this.state.controller.abort();\n    this.setState({ controller: new AbortController() });\n  }\n\n  initNFC() {\n    this.NDEF.write(JSON.stringify({\n      name: \"Nako\"\n    })).then(() => \n      console.log(\"Message written\")\n    ).catch(error => \n      console.log(error)\n    );\n  }\n//#endregion\n\n//#region QR\n  handleQRData(data: string) {\n    console.log(`${data}/${JSON.stringify(this.state.loginInfo!)}`);\n\n    Axios.get(`${data}/${JSON.stringify(this.state.loginInfo!)}`).catch(error => console.log(error));\n  }\n//#endregion\n\n  render() {\n    const { serverURL, ...rest } = this.props;\n    return (\n      <div {...rest}>\n        <div className={`${styles[\"m-login-container\"]} fill-parent`}>\n          {this.state.loginInfo ?\n          <>\n            <h1>Welcome back, {this.state.loginInfo.name}!</h1>\n            <button onClick={() => this.setState({ loginPhase: LoginPhase.QR })}>Desktop login with QR code</button>\n            {this.state.loginPhase === LoginPhase.QR ?\n            <div id={styles.qr} className={`${styles.overlay} fill-parent`}>\n              <span className=\"close\" onClick={() => this.setState({ loginPhase: LoginPhase.menu })}/>\n              <div>\n                <p>Scan the QR code shown on the webpage.</p>\n                <QRScanner className={styles[\"qr-component\"]} onScannedData={data => this.handleQRData(data)}/>\n              </div>\n            </div> : null}\n          </> :\n          <>\n            <Logo id={styles.logo} role=\"student\"/>\n            <button onClick={() => this.startNFCScan()}>Login using NFC</button>\n            {/* <button onClick={() => this.initNFC()}>Init NFC card</button>\n            <button onClick={() => this.setState({ loginInfo: { name: \"Nako\", role: \"student\" } })}>Debug</button> */}\n            {this.state.loginPhase === LoginPhase.NFC ?\n            <div id={styles.nfc} className={`${styles.overlay} fill-parent`}>\n              <span className=\"close\" onClick={() => {\n                this.endNFCScan();\n                this.setState({ loginPhase: LoginPhase.menu });\n              }}/>\n              <div>\n                <p>Place your Nako card on the back of your device.</p>\n              </div>\n            </div> : null}\n          </>}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}