{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Desktop/Nako/nako/src/desktop/login/login.tsx\";\nimport React from \"react\";\nimport Axios from \"axios\";\nimport { Link } from \"react-router-dom\";\nimport styles from \"./login.module.scss\";\nimport { delay } from \"../../utils\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass QR extends React.Component {\n  constructor(props) {\n    super(props);\n    this.willUnmount = false;\n\n    this.componentWillUnmount = () => this.willUnmount = true;\n\n    this.state = {\n      scanned: false\n    };\n    console.log(\"test\");\n    this.props.connection.get(`qr/${this.props.embed}`).then(res => this.setState({\n      imageSrc: res.data.img\n    }));\n    this.checkScanStatus();\n  }\n\n  async checkScanStatus() {\n    if (this.state.imageSrc) {\n      console.log(\"Checking\");\n      this.props.connection.get(`check/${this.props.embed}`).then(res => {\n        console.log(res.data);\n\n        if (res.data !== null) {\n          this.setState({\n            scanned: true\n          });\n          this.props.onScanned(res.data);\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    await delay(1000);\n\n    if (!this.willUnmount && !this.state.scanned) {\n      this.checkScanStatus();\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"section\", {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Scan the QR Code using Nako Mobile.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 9\n      }, this), this.state.imageSrc ? /*#__PURE__*/_jsxDEV(\"img\", {\n        src: `data:image/png;base64,${this.state.imageSrc}`,\n        alt: \"QR Code\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 9\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nvar LoginPhase;\n\n(function (LoginPhase) {\n  LoginPhase[\"Default\"] = \"Credentials\";\n  LoginPhase[\"QR\"] = \"QR code\";\n  LoginPhase[\"USB\"] = \"Nako figurine\";\n})(LoginPhase || (LoginPhase = {}));\n\nvar ErrorMessage;\n\n(function (ErrorMessage) {\n  ErrorMessage[\"Generic\"] = \"An error occurred while your request was being processed.\";\n  ErrorMessage[\"TimedOut\"] = \"Your request was timed out. Please try again.\";\n  ErrorMessage[\"InvalidLogin\"] = \"Your username or password is incorrect.\";\n})(ErrorMessage || (ErrorMessage = {}));\n\nexport class Login extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loginPhase: LoginPhase.Default,\n      showLoginMethodDropdown: false,\n      username: \"\",\n      password: \"\",\n      connection: Axios.create({\n        baseURL: \"http://localhost:5000/\",\n        timeout: 10000\n      }),\n      connected: false\n    };\n  }\n\n  async componentDidMount() {\n    while (!this.state.connected) {\n      const test = await this.state.connection.get(\"/\");\n\n      if (test.status === 200 || test.status === 201) {\n        this.setState({\n          connected: true\n        });\n      } else {\n        await delay(5000);\n      }\n    }\n  }\n\n  getAvailableLoginMethods() {\n    return Object.values(LoginPhase).filter(i => i !== this.state.loginPhase).map(i => /*#__PURE__*/_jsxDEV(\"span\", {\n      onClick: () => this.setState({\n        loginPhase: i\n      }),\n      children: i\n    }, i, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 88\n    }, this));\n  }\n\n  async getQRCode() {\n    if (!this.state.QRImageSrc) {\n      const id = Array.from(window.crypto.getRandomValues(new Uint8Array(8)), dec => dec.toString(16).padStart(2, \"0\")).join(\"\");\n      const res = await this.state.connection.get(`/qr/${id}`);\n      this.setState({\n        QRImageSrc: res.data.img\n      });\n    }\n  }\n\n  handleFormSubmit() {\n    this.setState({\n      error: undefined\n    });\n    this.state.connection.post(`login/${this.state.username}/${this.state.password}`, {\n      username: this.state.username,\n      password: this.state.password\n    }).then(res => {\n      res.data ? this.props.onLoggedIn(res.data) : this.setState({\n        error: ErrorMessage.InvalidLogin\n      });\n    }).catch(() => {\n      this.setState({\n        error: ErrorMessage.Generic\n      });\n    });\n  }\n\n  handleUSBData() {\n    navigator.usb.requestDevice({\n      filters: [{\n        productId: 4660,\n        vendorId: 43981\n      }]\n    }).then(device => {\n      console.log(device.manufacturerName);\n      this.props.onLoggedIn({\n        name: \"Nako\",\n        role: \"student\"\n      });\n    });\n  }\n\n  render() {\n    const {\n      onLoggedIn,\n      ...rest\n    } = this.props;\n    return /*#__PURE__*/_jsxDEV(\"div\", { ...rest,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: styles.background,\n        className: \"fill-parent\",\n        children: /*#__PURE__*/_jsxDEV(\"section\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            id: styles.title,\n            children: /*#__PURE__*/_jsxDEV(\"h2\", {\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                alt: \"Login icon\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 17\n              }, this), \"Login\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 158,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: styles.content,\n            children: [this.state.loginPhase === LoginPhase.Default ? /*#__PURE__*/_jsxDEV(\"form\", {\n              onSubmit: () => this.handleFormSubmit(),\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                className: \"box-shadow\",\n                placeholder: \"Username\",\n                autoComplete: \"username\",\n                onChange: e => this.setState({\n                  username: e.target.value\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                className: \"box-shadow\",\n                placeholder: \"Password\",\n                type: \"password\",\n                autoComplete: \"current-password\",\n                onChange: e => this.setState({\n                  password: e.target.value\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 172,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"box-shadow\",\n                type: \"submit\",\n                children: \"Login\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 15\n            }, this) : this.state.loginPhase === LoginPhase.QR ? /*#__PURE__*/_jsxDEV(QR, {\n              embed: Array.from(window.crypto.getRandomValues(new Uint8Array(8)), dec => dec.toString(16).padStart(2, \"0\")).join(\"\"),\n              connection: this.state.connection,\n              onScanned: loginInfo => this.props.onLoggedIn(loginInfo)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 15\n            }, this) : /*#__PURE__*/_jsxDEV(\"section\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Press the button below when you have connected your Nako figurine via USB.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => this.handleUSBData(),\n                children: \"Connect\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Forgot password\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Link, {\n                to: \"/register\",\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Register\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 194,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 193,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                id: styles[\"dropdown-menu\"],\n                onClick: () => this.setState({\n                  showLoginMethodDropdown: !this.state.showLoginMethodDropdown\n                }),\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Login via...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 197,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: /*#__PURE__*/_jsxDEV(CSSTransition, {\n                    in: this.state.showLoginMethodDropdown,\n                    timeout: 250,\n                    classNames: {\n                      enter: styles[\"reveal-enter\"],\n                      enterActive: styles[\"reveal-enter-active\"],\n                      enterDone: styles[\"reveal-enter-done\"],\n                      exit: styles[\"reveal-exit\"],\n                      exitActive: styles[\"reveal-exit-active\"],\n                      exitDone: styles[\"reveal-exit-done\"]\n                    },\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: this.getAvailableLoginMethods()\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 213,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 201,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 200,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 196,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this);\n  }\n\n}\nexport default Login;","map":{"version":3,"sources":["/Users/mac/Desktop/Nako/nako/src/desktop/login/login.tsx"],"names":["React","Axios","Link","styles","delay","CSSTransition","QR","Component","constructor","props","willUnmount","componentWillUnmount","state","scanned","console","log","connection","get","embed","then","res","setState","imageSrc","data","img","checkScanStatus","onScanned","catch","error","render","LoginPhase","ErrorMessage","Login","loginPhase","Default","showLoginMethodDropdown","username","password","create","baseURL","timeout","connected","componentDidMount","test","status","getAvailableLoginMethods","Object","values","filter","i","map","getQRCode","QRImageSrc","id","Array","from","window","crypto","getRandomValues","Uint8Array","dec","toString","padStart","join","handleFormSubmit","undefined","post","onLoggedIn","InvalidLogin","Generic","handleUSBData","navigator","usb","requestDevice","filters","productId","vendorId","device","manufacturerName","name","role","rest","background","title","content","e","target","value","loginInfo","enter","enterActive","enterDone","exit","exitActive","exitDone"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Axios, { AxiosInstance } from \"axios\";\nimport { Link } from \"react-router-dom\";\nimport styles from \"./login.module.scss\";\nimport { delay } from \"../../utils\";\nimport { AccountInfo } from \"../../modules/account-info\";\nimport { CSSTransition } from \"react-transition-group\";\n\ninterface QRProps {\n  embed: string;\n  connection: AxiosInstance;\n  onScanned: (loginInfo: AccountInfo) => void;\n}\n\ninterface QRState {\n  scanned: boolean;\n  imageSrc?: string;\n}\n\nclass QR extends React.Component<QRProps, QRState> {\n  willUnmount = false;\n\n  constructor(props: QRProps) {\n    super(props);\n\n    this.state = { scanned: false };\n    console.log(\"test\");\n    this.props.connection.get<{ img: string }>(`qr/${this.props.embed}`).then(res => this.setState({ imageSrc: res.data.img }));\n    this.checkScanStatus();\n  }\n\n  componentWillUnmount = () => this.willUnmount = true;\n\n  async checkScanStatus() {\n    if (this.state.imageSrc) {\n      console.log(\"Checking\");\n      this.props.connection.get<AccountInfo | null>(`check/${this.props.embed}`).then(res => {\n        console.log(res.data);\n\n        if (res.data !== null) {\n          this.setState({ scanned: true });\n          this.props.onScanned(res.data);\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    await delay(1000);\n\n    if (!this.willUnmount && !this.state.scanned) {\n      this.checkScanStatus();\n    }\n  }\n\n  render() {\n    return (\n      <section>\n        <span>Scan the QR Code using Nako Mobile.</span>\n        {this.state.imageSrc ?\n        <img src={`data:image/png;base64,${this.state.imageSrc}`} alt=\"QR Code\"/> : null}\n      </section>\n    );\n  }\n}\n\nenum LoginPhase {\n  Default = \"Credentials\",\n  QR = \"QR code\",\n  USB = \"Nako figurine\"\n}\n\nenum ErrorMessage {\n  Generic = \"An error occurred while your request was being processed.\",\n  TimedOut = \"Your request was timed out. Please try again.\",\n  InvalidLogin = \"Your username or password is incorrect.\"\n}\n\ninterface LoginProps {\n  onLoggedIn: (userInfo: AccountInfo) => void;\n}\n\ninterface LoginState {\n  loginPhase: LoginPhase;\n  showLoginMethodDropdown: boolean;\n  username: string;\n  password: string;\n  connection: AxiosInstance;\n  connected: boolean;\n  QRImageSrc?: string;\n  error?: ErrorMessage;\n}\n\nexport class Login extends React.Component<LoginProps & React.HTMLAttributes<HTMLDivElement>, LoginState> {\n  constructor(props: LoginProps & React.HTMLAttributes<HTMLDivElement>) {\n    super(props);\n\n    this.state = {\n      loginPhase: LoginPhase.Default,\n      showLoginMethodDropdown: false,\n      username: \"\",\n      password: \"\",\n      connection: Axios.create({ baseURL: \"http://localhost:5000/\", timeout: 10000 }),\n      connected: false\n    };\n  }\n\n  async componentDidMount() {\n    while (!this.state.connected) {\n      const test = await this.state.connection.get(\"/\");\n\n      if (test.status === 200 || test.status === 201) {\n        this.setState({ connected: true });\n      } else {\n        await delay(5000);\n      }\n    }\n  }\n\n  getAvailableLoginMethods() {\n    return Object.values(LoginPhase).filter(i => i !== this.state.loginPhase).map(i => <span key={i} onClick={() => this.setState({ loginPhase: i })}>{i}</span>);\n  }\n\n  async getQRCode() {\n    if (!this.state.QRImageSrc) {\n      const id = Array.from(window.crypto.getRandomValues(new Uint8Array(8)), dec => dec.toString(16).padStart(2, \"0\")).join(\"\");\n      const res = await this.state.connection.get<{ img: string }>(`/qr/${id}`);\n      this.setState({ QRImageSrc: res.data.img });\n    }\n  }\n\n  handleFormSubmit() {\n    this.setState({ error: undefined });\n    this.state.connection.post<AccountInfo | undefined>(`login/${this.state.username}/${this.state.password}`, {\n      username: this.state.username,\n      password: this.state.password\n    }).then(res => {\n      res.data ? this.props.onLoggedIn(res.data) : this.setState({ error: ErrorMessage.InvalidLogin })\n    }).catch(() => {\n      this.setState({ error: ErrorMessage.Generic });\n    });\n  }\n\n  handleUSBData() {\n    navigator.usb.requestDevice({ filters: [{ productId: 4660, vendorId: 43981 }] }).then(device => {\n      console.log(device.manufacturerName);\n      this.props.onLoggedIn({ name: \"Nako\", role: \"student\" });\n    })\n  }\n\n  render() {\n    const { onLoggedIn, ...rest } = this.props;\n    return (\n      <div {...rest}>\n        <div id={styles.background} className=\"fill-parent\">\n          <section>\n            <div id={styles.title}>\n              <h2>\n                <img alt=\"Login icon\"/>\n                Login\n              </h2>\n            </div>\n            <div id={styles.content}>\n              {this.state.loginPhase === LoginPhase.Default ?\n              <form onSubmit={() => this.handleFormSubmit()}>\n                <input\n                  className=\"box-shadow\"\n                  placeholder=\"Username\"\n                  autoComplete=\"username\"\n                  onChange={e => this.setState({ username: e.target.value })}\n                />\n                <input\n                  className=\"box-shadow\"\n                  placeholder=\"Password\"\n                  type=\"password\"\n                  autoComplete=\"current-password\"\n                  onChange={e => this.setState({ password: e.target.value })}\n                />\n                <button className=\"box-shadow\" type=\"submit\">Login</button>\n              </form> :\n              this.state.loginPhase === LoginPhase.QR ?\n              <QR\n               embed={Array.from(window.crypto.getRandomValues(new Uint8Array(8)), dec => dec.toString(16).padStart(2, \"0\")).join(\"\")}\n               connection={this.state.connection}\n               onScanned={loginInfo => this.props.onLoggedIn(loginInfo)}\n              /> :\n              <section>\n                <span>Press the button below when you have connected your Nako figurine via USB.</span>\n                <button onClick={() => this.handleUSBData()}>Connect</button>\n              </section>}\n              <div>\n                <span>Forgot password</span>\n                <Link to=\"/register\">\n                  <span>Register</span>\n                </Link>\n                <div id={styles[\"dropdown-menu\"]} onClick={() => this.setState({ showLoginMethodDropdown: !this.state.showLoginMethodDropdown })}>\n                  <span>\n                    Login via...\n                  </span>\n                  <div>\n                    <CSSTransition\n                      in={this.state.showLoginMethodDropdown}\n                      timeout={250}\n                      classNames={{\n                        enter: styles[\"reveal-enter\"],\n                        enterActive: styles[\"reveal-enter-active\"],\n                        enterDone: styles[\"reveal-enter-done\"],\n                        exit: styles[\"reveal-exit\"],\n                        exitActive: styles[\"reveal-exit-active\"],\n                        exitDone: styles[\"reveal-exit-done\"]\n                      }}\n                    >\n                      <div>\n                        {this.getAvailableLoginMethods()}\n                      </div>\n                    </CSSTransition>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}